<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8" />
		<title>JQuery滚动条</title>
		<link rel="stylesheet" type="text/css" href="css/reset.css" />
		<style type="text/css">
			body {
				background: #ccc;
			}
			
			.scroll-demo {
				width: 540px;
				margin: 30px auto;
				border: 1px solid #ddd;
				background: #fff;
			}
			/*标签切换区域*/
			
			.scroll-tab {
				height: 34px;
				line-height: 34px;
				border: 1px solid #e5e5e5;
				color: #666;
				background: #f8f8f8;
			}
			
			.scroll-tab .tab-item {
				height: 100%;
				padding: 0 20px;
				border-right: 1px solid #e5e5e5;
				font-size: 14px;
				text-align: center;
				float: left;
				box-sizing: content-box;
			}
			
			.scroll-tab .tab-active {
				margin: -1px 0;
				color: #00be2c;
				background: #fff;
				border-top: 2px solid #00be2c;
			}
			/*滚动内容该区域*/
			
			.scroll-wrap {
				width: 100%;
				height: 300px;
				position: relative;
			}
			/*滚动内容*/
			
			.scroll-wrap .scroll-cont {
				height: 100%;
				padding: 0 15px;
				overflow: hidden;
			}
			
			.scroll-wrap .scroll-cont h3 {
				font-size: 16px;
				line-height: 48px;
				text-align: center;
			}
			
			.scroll-wrap .scroll-cont p {
				font-size: 14px;
				line-height: 20px;
				text-indent: 2em;
				margin: 10px;
			}
			/*滚动条*/
			
			.scroll-wrap .scroll-bar {
				top: 0;
				right: 0;
				width: 10px;
				height: 100%;
				background: #ddd;
				position: absolute;
			}
			
			.scroll-wrap .scroll-bar .scroll-slider {
				top: 0;
				left: 1px;
				width: 8px;
				height: 30px;
				background-color: #fff;
				position: absolute;
			}
		</style>
	</head>

	<body>
		<!--示例容器-->
		<div class="scroll-demo">
			<!--标签切换区域-->
			<ul class="scroll-tab clearfix">
				<li class="tab-item tab-active">第一篇</li>
				<li class="tab-item">第二篇</li>
				<li class="tab-item">第三篇</li>
				<li class="tab-item">第四篇</li>
			</ul>
			<!--滚动内容区域-->
			<div class="scroll-wrap">
				<!--滚动条-->
				<div class="scroll-bar">
					<!--滚动滑块儿-->
					<div class="scroll-slider"></div>
				</div>
				<!--滚动内容-->
				<div class="scroll-cont">
					<h3 class="anchor">春天来了</h3>
					<div class="scroll-ol">
						<p>春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了</p>
						<p>春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了</p>
						<p>春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了</p>
						<p>春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了春天来了</p>
					</div>
					<h3 class="anchor">夏天来了</h3>
					<div class="scroll-ol">
						<p>夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了</p>
						<p>夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了</p>
						<p>夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了</p>
						<p>夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了</p>
						<p>夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了夏天来了</p>
					</div>
					<h3 class="anchor">秋天来了</h3>
					<div class="scroll-ol">
						<p>秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了</p>
						<p>秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了</p>
						<p>秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了</p>
						<p>秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了秋天来了</p>
					</div>
					<h3 class="anchor">冬天来了</h3>
					<div class="scroll-ol">
						<p>冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了</p>
						<p>冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了</p>
						<p>冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了</p>
						<p>冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了</p>
						<p>冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了</p>
						<p>冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了冬天来了</p>
					</div>
				</div>

			</div>
		</div>
		<script src="js/jquery.min.js" type="text/javascript" charset="utf-8"></script>
		<script type="text/javascript">
			(function(win, dom, $) {
				function CusScollBar(options) {
					this._init(options);
				}
				$.extend(CusScollBar.prototype, {
					_init: function(options) {
						var self = this;
						self.options = {
							scrollDir: "y", // 滚动方向
							contSelector: "", // 滚动内容区域选择器
							barSelector: "", // 滚动条选择器
							sliderSelector: "", // 滚动滑块儿选择器
							tabItemSelector: ".tab-item", // 标签选择器
							tabActiveClass: "tab-active", // 选中标签名
							anchorSelector: ".anchor", // 正题选择器
							wheelStep: 20 // 滚动步长
						}

						$.extend(true, self.options, options || {});

						this._initDomEvent();
						return self;
					},
					/*
					 * 初始化Dom引用
					 * @method _initDomEvent
					 * @return {CusScollBar}
					 * */
					_initDomEvent: function() {
						var opts = this.options;
						this.$cont = $(opts.contSelector);
						this.$slider = $(opts.sliderSelector);
						this.$bar = opts.barSelector ? $(opts.barSelector) : self.parent();
						this.$tabItem = $(opts.tabItemSelector);
						this.$anchor = $(opts.anchorSelector);
						this.$dom = $(dom);

						this._iniTabEvent()._initSliderDragEvent()._bindContScroll()._bindMousewheel();
					},
					/*
					 * 初始化拖块儿功能
					 * @return {[Object]} [this]
					 * */
					_initSliderDragEvent: function() {
						var self = this,
							slider = self.$slider,
							sliderEl = slider[0];

						if(sliderEl) {
							var dom = this.$dom,
								dragStartPagePostion,
								dragStartScrollPostion,
								dragContBarRate;

							function mousemoveHandler(e) {
								e.preventDefault();
								console.log("mousemove");
								if(dragStartPagePostion == null) {
									return;
								}
								self.scrollTo(dragStartScrollPostion + (e.pageY - dragStartPagePostion) * dragContBarRate);
							}
							slider.on("mousedown", function(e) {
								e.preventDefault();
								console.log("mousedown");
								dragStartPagePostion = e.pageY;
								dragStartScrollPostion = self.$cont[0].scrollTop;
								dragContBarRate = self.getMaxScrollPosition() / self.getMaxSliderPostion();

								dom.on("mousemove.scroll", mousemoveHandler).on("mouseup.scroll", function() {
									console.log("mouseup");
									dom.off(".scroll");
								});
							});

						}

						return this;
					},
					/*
					 * 初始化标签切换功能
					 * */
					_iniTabEvent: function() {
						var self = this;
						self.$tabItem.on("click", function(e) {
							e.preventDefault();
							var index = $(this).index();
							self.changeTabSelect(index);
							// 滚动到指定高度
							self.scrollTo(self.$cont[0].scrollTop + self.getAnchorPosition(index));
						});
						return self;
					},
					changeTabSelect: function(index) {
						var self = this,
							active = self.options.tabActiveClass;
						return self.$tabItem.eq(index).addClass(active).siblings().removeClass(active);
					},
					/**
					 * 监听内容滚动，滑块儿同步位置
					 */
					_bindContScroll: function() {
						var self = this;
						self.$cont.on("scroll", function() {
							var sliderEl = self.$slider && self.$slider[0];
							if(sliderEl) {
								sliderEl.style.top = self.getSliderPostion() + "px";
							}
						});
						return self;
					},
					_bindMousewheel: function() {
						var self = this;
						self.$cont.on("mousewheel DOMMouseScroll", function(e) {
							e.preventDefault();
							var oEv = e.originalEvent,
								wheelRange = oEv.wheelDelta ? -oEv.wheelDelta / 120 : ((oEv.detail || 0) / 3);
							self.scrollTo(self.$cont[0].scrollTop + wheelRange * self.options.wheelStep);
						});
						return self;
					},
					/*
					 * 获取指定锚点的上边距像素值
					 * */
					getAnchorPosition: function(index) {
						return this.$anchor.eq(index).position().top;
					},
					getAllAnchorPosition: function(){
						var self = this,
								allPositionArr = [];
						for(var i = 0;i < self.$anchor.length;i++){
							allPositionArr.push(self.$cont[0].scrollTop + self.getAnchorPosition(i));
						}
						return allPositionArr;
					},
					/*
					 * 获取滑块儿档期那位置
					 * */
					getSliderPostion: function() {
						var self = this,
							maxSliderPosition = self.getMaxSliderPostion();

						return Math.min(maxSliderPosition, maxSliderPosition * self.$cont[0].scrollTop / self.getMaxScrollPosition());
					},
					/*
					 * 获取内容区域可移动的距离
					 * */
					getMaxScrollPosition: function() {
						var self = this;
						return Math.max(self.$cont.height(), self.$cont[0].scrollHeight) - self.$cont.height();
					},
					/*
					 * 获取滑块儿可移动的距离
					 * */
					getMaxSliderPostion: function() {
						var self = this;
						return self.$bar.height() - self.$slider.height();
					},
					scrollTo: function(positionVal) {
						var self = this,
								posArr = self.getAllAnchorPosition();
						
						// 获取对应的与滚动内容相对应的滚动标签的索引
						function getIndex(positionVal){
							for(var i = posArr.length - 1; i >= 0;i--){
								if(positionVal >= posArr[i]){
									return i;
								}
							}
						}
						if(posArr.length == self.$tabItem.length){
							self.changeTabSelect(getIndex(positionVal));
						}
						self.$cont.scrollTop(positionVal);
					}
				});
				//				CusScollBar.prototype._init = function(){
				//					console.log("1");
				//				}
				win.CusScollBar = CusScollBar;
			})(window, document, jQuery);

			new CusScollBar({
				contSelector: ".scroll-cont",
				barSelector: ".scroll-bar",
				sliderSelector: ".scroll-slider"

			});
		</script>
	</body>

</html>